1. Начинает новую сессию с помощью session_start().
2. Проверяет, была ли форма уже отправлена для данного пользователя, проверяя наличие ключа 'form_submitted' в сессии. Если ключ существует, выводится сообщение "Форма уже была отправлена!" и код прекращает выполнение.
3. Получает данные из формы, такие как имя ($name), номер телефона ($phone), скрытое поле ($hiddenField), используя массив $_POST.
4. Проверяет корректность номера телефона, сравнивая его с регулярным выражением /^\+7\(\d{3}\)\d{3}-\d{2}-\d{2}$/. Если номер телефона соответствует регулярному выражению, выводится сообщение "Номер телефона корректный!". В противном случае выводится сообщение "Некорректный номер телефона!" и код прекращает выполнение.
5. Формирует данные для отправки на сторонний сервис в виде массива $data включая потоковый код ('stream_code'), данные клиента ('client'), включающие имя и номер телефона, и дополнительное поле ('sub1') со значением скрытого поля.
6. Преобразует данные в формат JSON с помощью json_encode() и сохраняет результат в переменную $jsonData.
7. Устанавливает URL стороннего сервиса для отправки запроса.
8. Настраивает заголовки запроса, включая тип контента 'Content-type: application/json' и токен авторизации 'Authorization: Bearer NWJLZGEWOWETNTGZMS00MZK4LWFIZJUTNJVMOTG0NJQXOTI3'.
9. Создает контекст запроса с помощью stream_context_create() на основе настроек запроса.
10. Отправляет POST-запрос на указанный URL стороннего сервиса с использованием file_get_contents(), передавая данные и контекст.
11. Если получен ответ ($result), сохраняет информацию об отправке формы в сессию с помощью $_SESSION['form_submitted'] = true;.
12. Выполняет перенаправление на страницу "Спасибо за заказ" (thank_you.php) с помощью header("Location: thank_you.php"); в случае успешной отправки формы.
13. Если при отправке запроса возникает ошибка, выполняет перенаправление на страницу "Ошибка" (error.php) с помощью header("Location: error.php");.
